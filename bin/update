#!/usr/bin/env bash

set -e

DOTFILES=${DOTFILES:-"$HOME/.dotfiles"}

# shellcheck source=../.utils/functions.sh
source "${DOTFILES}/.utils/functions.sh"

load_env_file

force_sudo

# all of our zsh files
install_files=("$DOTFILES"/*/install.sh)

log_debug "$(pp_array "install_files")"

# shellcheck disable=SC2068
for file in ${install_files[@]}; do
    task="$(basename "$(dirname "${file}")")"
    skipEnvVar="DOTFILES_INSTALL_${task^^}"
    [[ "${!skipEnvVar:-true}" == true ]] || continue

    log_info "Installing: $task"
    # shellcheck disable=SC1090
    source "$file"
done

unset install_files
